\subsubsection{可測関数}

{\color{red} TODO 文章考え直す}
次に，可測写像 $f:X\to Y$ の積分を考えたい．
そのためにはもう少し空間に構造を課す必要がある．
まず，積分演算は線形性を持つべきという観点から，$Y$ (すなわち，積分の値が属する空間) はベクトル空間であってほしい．
また，積分を定義する際に極限操作が必要となるので，$Y$ は位相空間にもなっていてほしい．
従って，$Y$ が位相ベクトル空間であることを要請したい．
そのようなもののうち最も基本的な状況として，$Y$ が``数''の空間である場合を考えよう
\footnote{このように動機付けを行なったが，残念ながら
定義 \ref{def:measurable_function} に現れる $\Rbb\cup\{\pm\infty\}$ はベクトル空間ではない．
$(+\infty)+(-\infty)$ などが定義できないため．}
\footnote{他にも，$Y$ が Banach 空間の場合に適用できる積分の理論がある (Bochner 積分という)．}．

\begin{definition}\label{def:measurable_function}
    $(X,\Afrak)$ を可測空間，$Y=\Rbb\cup\{\pm\infty\} $ または $\Cbb$ とする．
    例 \ref{ex:Borel_algebra}, \ref{ex:extended_real} によって $(Y,\Bfrak(Y))$ も可測空間となる．
    このときの可測写像 $f:X\to Y$ を可測関数 (measurable function) という
    \footnote{このように可測写像と可測関数を呼び分けている文献はあまり見かけないが，ある程度妥当な命名だと思う\cite{ms95741}．}．
    特に，$E\subset\Rbb^n$ に対して，(例 \ref{ex:relative_sigma_algebra} の記法を用いて)
    \begin{enumerate}
        \item $(X,\Afrak)=(E,(\Bfrak^n)_E)$ のとき，$f$ を Borel 可測関数という．
        \item $(X,\Afrak)=(E,(\Bfrak_\Lrm^n)_E)$ のとき，$f$ を Lebesgue 可測関数という．
    \end{enumerate}
\end{definition}

\begin{remark}
    定義 \ref{def:measurable_function} は次の意味で consistent である：
    \begin{itemize}
        \item 関数 $f:X\to\Rbb$ に対して，$f:X\to\Rbb\cup\{\pm\infty\}$ と見なしたときの可測性と
        $f:X\to\Cbb$ と見なしたときの可測性は同値になる．
    \end{itemize}
    {\color{red} TODO why?}
\end{remark}

\begin{remark}\label{rem:Borel_implies_Lebesgue}
    注意 \ref{rem:Borel_Lebesgue} により $\Bfrak^n\subset\Bfrak_\Lrm^n$ なので，Borel 可測関数は Lebesgue 可測である．
    特に命題 \ref{prop:conti_implies_measurable} により，連続関数は Lebesgue 可測である．
\end{remark}

\begin{remark}[\!\!\cite{mo31603}]
    可測関数 $f:X\to Y$ の定義において，$Y$ 上の $\sigma$-加法族として常に Borel 集合族 $\Bfrak(Y)$ を選んでいることに注意．
    $f$ が $\Rbb$-値 や $\Cbb\,(\simeq\Rbb^2)$-値のとき，
    $Y$ 上の $\sigma$-加法族として $\Bfrak_\Lrm^1$ や $\Bfrak_\Lrm^2$ を選ぶこともできるが，
    そのようにして定義された可測関数はあまり良い性質を持たない．
    たとえば，注意 \ref{rem:Borel_implies_Lebesgue} で見た，連続関数が可測になるという性質はもはや成立しなくなる．

    測度論で扱える関数 (または，積分できる関数) を増やしたいという文脈では，できるだけ多くの関数 $f:X\to Y$ が可測になってほしい．
    そのためには $X$ 上の $\sigma$-加法族はできるだけ大きいものを，$Y$ 上の $\sigma$-加法族はできるだけ小さいものを選択するのがよさそうである．
    この意味で，$X$ 上の $\sigma$-加法族として $(\Bfrak_\Lrm^n)_E$ を選ぶのは理にかなっており，
    {\color{red}(TODO 完備化のことを書く)}
    一方で $Y$ 上の $\sigma$-加法族として $\Bfrak_\Lrm^1$ などを選ぶのは不合理である．
    また，後に \ref{sec:integration} 節で $f$ の積分を定義する際には，$Y$ の区間の $f$ による逆像が $X$ の可測集合になることを要請したい
    (命題 \ref{prop:approx_measurable_by_simple} の証明を参照)．
    $\Bfrak(Y)$ はこの要請を満たす $\sigma$-加法族として最小のものである．
    {\color{red}
    これをふまえて書き直す https://math.stackexchange.com/questions/3033951/confusion-about-measurability-requirements-for-lebesgue-integral
    }
\end{remark}

可測関数の特徴づけとして次のことが知られている (こちらを可測関数の定義とすることも多い)．

\begin{proposition}\label{prop:measurable_function_characterization}
    可測空間 $(X,\Afrak)$ に対して次が成り立つ．
    \begin{enumerate}
        \item $f:X\to\Rbb\cup\{\pm\infty\}$ が可測関数であることは，次のうち任意の一つと同値．
            \begin{enumerate}
                \item 任意の $a\in\Rbb$ に対して $f^{-1}([-\infty,a))\in\Afrak$．
                \item 任意の $a\in\Rbb$ に対して $f^{-1}([-\infty,a])\in\Afrak$．
                \item 任意の $a\in\Rbb$ に対して $f^{-1}((a,+\infty])\in\Afrak$．
                \item 任意の $a\in\Rbb$ に対して $f^{-1}([a,+\infty])\in\Afrak$．
            \end{enumerate}
        \item $f:X\to\Cbb$ が可測関数であることは，$\Re f:X\to\Rbb,\ \Im f:X\to\Rbb$ が共に可測関数であることと同値．
    \end{enumerate}
\end{proposition}

\begin{proof}
    \textrm{i)} を示す．
    \begin{itemize}[align=left]
        \item[$f$ が可測 $\Rightarrow$ (a)--(d)：]
            明らか．
        \item[(a) $\Rightarrow$ (b)：]
            $\displaystyle f^{-1}([-\infty,a])=\bigcap_{k=1}^\infty f^{-1}\biggl(\biggl[-\infty,a+\frac{1}{k}\biggr)\biggr)\in\Afrak$ より従う．
        \item[(b) $\Rightarrow$ (c)：]
            $\displaystyle f^{-1}((a,+\infty])=X\setminus f^{-1}([-\infty,a])\in\Afrak$ より従う．
        \item[(c) $\Rightarrow$ (d)：]
            $\displaystyle f^{-1}([a,+\infty])=\bigcap_{k=1}^\infty f^{-1}\biggl(\biggl(a-\frac{1}{k},+\infty\biggr]\biggr)\in\Afrak$ より従う．
        \item[(d) $\Rightarrow$ (a)：]
            $\displaystyle f^{-1}([-\infty,a))=X\setminus f^{-1}([a,+\infty])\in\Afrak$ より従う．
        \item[(a), (c) $\Rightarrow$ $f$ が可測：]
            (a), (c) より $\Rbb$ の任意の開区間 $I$ に対して $f^{-1}(I)\in\Afrak$ となる．
            $\Rbb$ の開集合 $O$ は開区間の可算個の和集合として表される\footnote{
                $O$ の各点 $x$ に対して，$x$ を含み $O$ に含まれるような開区間 $I_x$ を取る．
                $\bigcup_{x\in O}I_x=O$ なので，特に $\{I_x\}_{x\in O}$ は $O$ の開被覆である．
                Lindel\"of の被覆定理 \cite[付録 \S2 定理 2]{It63} によって，これらから可算無限個を
                抜き出して，なお $O$ を被覆するようにできる．
            }ので，$f^{-1}(O)\in\Afrak$ も分かる．
            このことと \eqref{eqn:extended_real_topology} より，$\Rbb\cup\{\pm\infty\}$ の位相を $\widetilde\Ocal$ として
            \begin{align*}
                \widetilde\Ocal\subset\{A\subset\Rbb\cup\{\pm\infty\}\mid f^{-1}(A)\in\Afrak\}
            \end{align*}
            となる．
            この右辺は $\Rbb\cup\{\pm\infty\}$ 上の $\sigma$-加法族であるから $\Bfrak(\Rbb\cup\{\pm\infty\})$ を含む．
            ゆえに $f$ は可測である．
    \end{itemize}
    \textrm{ii)} は命題 \ref{prop:Meas_product} と系 \ref{cor:Borel_product} より直ちに従う．
\end{proof}

\begin{remark}
    Borel 可測関数や Lebesgue 可測関数の合成関数の可測性についてまとめておく．

    $E\subset\Rbb^n$ とし，$Y=\Rbb\cup\{\pm\infty\}$ または $\Cbb$ とする．
    $f:E\to\Rbb,\ g:\Rbb\to Y$ に対して，$g\circ f$ の可測性は次の表のようになる．

    \begin{table}[h]
        \centering
        \begin{tabular}{|c|c||c|}
            \hline
            $f$ & $g$ & $g\circ f$\\
            \hhline{|=|=#=|}
            Borel 可測 & Borel 可測 & Borel 可測\\
            \hline
            Lebesgue 可測 & Borel 可測 & Lebesgue 可測\\
            \hline
            Borel 可測 & Lebesgue 可測 & 何もいえない\\
            \hline
            Lebesgue 可測 & Lebesgue 可測 & 何もいえない\\
            \hline
        \end{tabular}
    \end{table}

    特に，$g$ が Lebesgue 可測であることしか分かっていないときには，合成関数の可測性については何も保証されないことに注意．
    $1,2$ 行目は可測関数の定義と $\Bfrak^n\subset\Bfrak_\Lrm^n$ から直ちに従う．
    $3$ 行目は反例が \cite[\S2 Exercise 9]{Fo99}\cite[pp.72--73]{It63} にある．
    $4$ 行目は $3$ 行目から直ちに従う．
\end{remark}

\begin{theorem}\label{thm:elementary_measuable_functions}
    $(X,\Afrak)$ を可測空間とする．
    \begin{enumerate}
        \item 可測関数 $f:X\to\Cbb,\ g:X\to\Cbb$ と $\alpha\in\Cbb,\ p>0$ に対して，$f+g,\ \alpha f,\ fg,\ |f|^p$ は可測である．
        \item 可測関数列 $(f_n:X\to\Rbb\cup\{\pm\infty\})_{n=1}^\infty$ に対して，
            $\displaystyle\sup_{n\ge1}f_n,\ \inf_{n\ge1}f_n$ は可測である．
    \end{enumerate}
    {\color{red} TODO limsup, liminf について書く。$\Rbb\cup\{\pm\}$ のケースをどこまで書くか}
\end{theorem}

\begin{proof}
    {\color{red} TODO}
\end{proof}

\begin{corollary}\label{cor:measurable_function_pointwise_convergence}
    $(X,\Afrak)$ を可測空間，$Y=\Rbb\cup\{\pm\infty\}$ または $\Cbb$ とする．
    可測関数列 $(f_n:X\to Y)_{n=1}^\infty$ が関数 $f:X\to Y$ に $X$ 上で各点収束するなら，$f$ も可測である．
\end{corollary}

\begin{proof}
    {\color{red} TODO}
\end{proof}

\begin{remark}
    系 \ref{cor:measurable_function_pointwise_convergence} は可測関数の空間が各点収束について閉じていることを意味している．
    これは連続関数の空間との著しい違いである．
    たとえば $X=[0,1],f_n=x^n$ のとき，$(f_n)_{n=1}^\infty$ の各点収束極限 $\chi_{\{1\}}$ は連続ではない．
    「連続関数列の一様収束極限は連続である」という定理は，
    連続関数の空間における系 \ref{cor:measurable_function_pointwise_convergence} の一つの対応物と考えられる．
\end{remark}
